---

- name: Create new Debian LXC container in Proxmox

  hosts: 'proxmox' # defined in inventory
  tasks:
  - name: 'create philcifone.com container'
    proxmox:
      vmid: '126' # specify container ID
      api_user: 'root@pam' # proxmox user
      api_password: "{{ proxmox_pass }}" # encrypted password variable !!!
      api_host: 'pve' # proxmox hostname
      password: "{{ ct_pass }}" # encrypted password variable !!!
      hostname: 'philcifone.com' # container hostname
      node: 'pve' # name of proxmox host
      cores: '1'
      ostemplate: 'local:vztmpl/archlinux-base_20221111-1_amd64.tar.zst'
      storage: 'local-lvm' # rootfs - can use 'local' or 'local-lvm'
      disk: '8' # size in GB
      memory: '1024' # size in MB
      swap: '512' # size in MB  
      unprivileged: true 
      netif: '{"net0":"name=eth0,ip=dhcp,ip6=dhcp,bridge=vmbr0,firewall=yes"}' # network settings
     # ip_address: 10.0.0.144
     # mounts: '{"mp0":":,mp=/mnt/}' # additional mount points
      features: 
        - nesting=1
      onboot: true
      state: 'present'
    vars:
      proxmox_pass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32346134373966326563373836633539616561636430663966653333663066366132303666313266
          3934373234303739323333363138343733356437653164340a383664653766623663326565313635
          38633831623630323662393839353937383738646236633738623766646332363864653835373837
          3337643233353265310a666164393334363435646339633536316236313232376333343136333237
          62316165376663323738653132633864616439313630633863323433333866656537
      ct_pass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37646130343232626337613761613366333565343136623736393631633962653238323534336636
          3932656538636532343039653939323932303133643161310a623662363733666664373232626431
          36376537383362383133643432613061356436343330313462643363366630343961656639643130
          3734313232663138360a323930666434313532656634363465666161336461353235346331396636
          66366431326237346336306139303166383830643865653166643736363632323462
          
  - name: 'start container'
    proxmox:
      vmid: '126'
      api_user: 'root@pam'
      api_password: "{{ proxmox_pass2 }}"
      api_host: 'pve'
      state: 'started'
    vars:
      proxmox_pass2: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32346134373966326563373836633539616561636430663966653333663066366132303666313266
          3934373234303739323333363138343733356437653164340a383664653766623663326565313635
          38633831623630323662393839353937383738646236633738623766646332363864653835373837
          3337643233353265310a666164393334363435646339633536316236313232376333343136333237
          62316165376663323738653132633864616439313630633863323433333866656537

